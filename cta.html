<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">
  <title>Call to Action</title>
  <link rel="icon" href="data:,">

  <!-- Firebase for Analytics -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <script>
    // Device Configuration
    window.CONFIG = {
      PROJECT_ID: 'prj004',
      DEVICE_ID: 'prj002-mahogany-cta'
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      const firebaseConfig = {
        apiKey: "AIzaSy" + "CZ4TnAas5EY0iLrNP2m-NlMEh46hRe1d4",
        authDomain: "aquamx-system.firebaseapp.com",
        projectId: "aquamx-system",
        storageBucket: "aquamx-system.firebasestorage.app",
        messagingSenderId: "893876394311",
        appId: "1:893876394311:web:85541afc56d2325d631462"
      };
      firebase.initializeApp(firebaseConfig);
    }
    window.db = firebase.firestore();

    // Touch Analytics
    let touchCount = 0;
    let lastSyncTime = Date.now();

    function trackTouch(element) {
      touchCount++;
      db.collection('touch_analytics').add({
        device_id: window.CONFIG.DEVICE_ID,
        project_id: window.CONFIG.PROJECT_ID,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        element: element || 'cta-page',
        action: 'click',
        page: 'cta.html',
        session_date: new Date().toISOString().split('T')[0]
      }).catch(err => console.error('Touch tracking error:', err));

      if (Date.now() - lastSyncTime >= 60000) {
        updateDailySummary();
        lastSyncTime = Date.now();
      }
    }

    function updateDailySummary() {
      if (touchCount === 0) return;
      const today = new Date().toISOString().split('T')[0];
      db.collection('touch_summary').doc(`${window.CONFIG.DEVICE_ID}_${today}`).set({
        device_id: window.CONFIG.DEVICE_ID,
        project_id: window.CONFIG.PROJECT_ID,
        date: today,
        touch_count: firebase.firestore.FieldValue.increment(touchCount),
        last_updated: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true }).then(() => {
        console.log(`‚úÖ Synced ${touchCount} touches`);
        touchCount = 0;
      });
    }

    document.addEventListener('click', () => trackTouch('cta-screen'), { passive: true });
    document.addEventListener('touchstart', () => trackTouch('cta-screen'), { passive: true });
    window.addEventListener('beforeunload', () => { if (touchCount > 0) updateDailySummary(); });

    console.log('üîç Touch analytics enabled for CTA page');
  </script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100vw;
      height: 100vh;
      background-color: #000;
      overflow: hidden;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
    }

    /* Safe viewport and frame scaling */
    .safe-viewport {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      overflow: hidden;
    }

    #frame {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 1080px;
      height: 1920px;
      background: linear-gradient(135deg, #1e1e2e 0%, #2d2d44 100%);
      overflow: hidden;
      transform: translate(-50%, -50%) scale(1);
      transform-origin: center center;
      will-change: transform;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .cta-header {
      flex-shrink: 0;
      background: rgba(20, 20, 30, 0.95);
      backdrop-filter: blur(10px);
      padding: 20px 30px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
      z-index: 100;
    }

    .back-button {
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 30px;
      color: #fff;
      font-size: 32px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.3s ease;
    }

    .back-button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateX(-5px);
    }

    .header-title {
      color: #fff;
      font-size: 36px;
      font-weight: 700;
    }

    /* Content container */
    .cta-content {
      flex: 1;
      padding: 20px 30px;
      max-width: 1020px;
      margin: 0 auto;
      overflow-y: auto;
      overflow-x: hidden;
      width: 100%;
    }

    /* Scrollbar styling for content */
    .cta-content::-webkit-scrollbar {
      width: 8px;
    }

    .cta-content::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
    }

    .cta-content::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
    }

    .cta-content::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Business header */
    .business-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .business-logo {
      width: 168px;
      height: 168px;
      object-fit: contain;
      margin: 0 auto 15px;
      border-radius: 15px;
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
    }

    .business-name {
      font-size: 36px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
    }

    .business-category {
      font-size: 22px;
      color: rgba(255, 255, 255, 0.7);
    }

    .business-description {
      font-size: 20px;
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.4;
      margin-top: 10px;
    }

    /* Contact Type */
    .contact-info {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .contact-item {
      display: flex;
      align-items: center;
      padding: 18px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .contact-item:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: translateX(10px);
    }

    .contact-icon {
      font-size: 36px;
      margin-right: 18px;
    }

    .contact-details {
      flex: 1;
    }

    .contact-label {
      font-size: 18px;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 4px;
    }

    .contact-value {
      font-size: 28px;
      color: #fff;
      font-weight: 600;
    }

    /* Order Type - Menu Items */
    .menu-items {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .menu-item {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .menu-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .menu-item-image {
      width: 100%;
      height: 250px;
      object-fit: cover;
    }

    .menu-item-info {
      padding: 20px;
    }

    .menu-item-name {
      font-size: 28px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
    }

    .menu-item-description {
      font-size: 20px;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 15px;
      line-height: 1.4;
    }

    .menu-item-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .menu-item-price {
      font-size: 32px;
      font-weight: 700;
      color: #ffa500;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .qty-btn {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: #fff;
      font-size: 28px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .qty-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .qty-display {
      font-size: 28px;
      font-weight: 700;
      color: #fff;
      min-width: 40px;
      text-align: center;
    }

    /* Shopping Cart */
    .cart-summary {
      position: sticky;
      bottom: 0;
      background: rgba(20, 20, 30, 0.98);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-top: 2px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .cart-total {
      font-size: 40px;
      font-weight: 700;
      color: #fff;
    }

    .cart-total-label {
      font-size: 24px;
      color: rgba(255, 255, 255, 0.6);
      margin-right: 15px;
    }

    /* Form Inputs */
    .form-group {
      margin-bottom: 25px;
    }

    .form-label {
      font-size: 26px;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 10px;
      display: block;
    }

    .form-input {
      width: 100%;
      padding: 20px;
      background: rgba(255, 255, 255, 0.08);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      color: #fff;
      font-size: 28px;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #ffa500;
      background: rgba(255, 255, 255, 0.12);
    }

    .form-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    textarea.form-input {
      min-height: 150px;
      resize: vertical;
    }

    /* Date/Time Picker */
    .datetime-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    /* Number of guests selector */
    .guests-selector {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 10px;
      padding: 20px;
    }

    .guests-controls {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .guests-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: #fff;
      font-size: 36px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .guests-display {
      font-size: 40px;
      font-weight: 700;
      color: #fff;
      min-width: 60px;
      text-align: center;
    }

    /* Action Buttons */
    .action-button {
      width: 100%;
      padding: 25px;
      background: linear-gradient(135deg, rgba(255, 107, 0, 0.9), rgba(255, 152, 0, 0.9));
      border: 3px solid rgba(255, 255, 255, 0.8);
      border-radius: 50px;
      color: #fff;
      font-size: 42px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 30px;
      box-shadow: 0 8px 30px rgba(255, 107, 0, 0.4);
    }

    .action-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 40px rgba(255, 107, 0, 0.6);
    }

    .action-button:active {
      transform: translateY(0);
    }

    .action-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Success/Error Messages */
    .message {
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      font-size: 28px;
      text-align: center;
      display: none;
    }

    .message.success {
      background: rgba(46, 213, 115, 0.2);
      border: 2px solid rgba(46, 213, 115, 0.5);
      color: #2ed573;
    }

    .message.error {
      background: rgba(255, 71, 87, 0.2);
      border: 2px solid rgba(255, 71, 87, 0.5);
      color: #ff4757;
    }

    .message.show {
      display: block;
    }

    /* Loading state */
    .loading {
      text-align: center;
      padding: 60px;
      font-size: 32px;
      color: rgba(255, 255, 255, 0.6);
    }

    /* Hidden state */
    .hidden {
      display: none !important;
    }

    /* Map iframe */
    .map-container {
      width: 100%;
      height: 400px;
      border-radius: 15px;
      overflow: hidden;
      margin-top: 30px;
    }

    .map-container iframe {
      width: 100%;
      height: 100%;
      border: 0;
    }

    /* QR Code display */
    .qr-code-container {
      text-align: center;
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      margin-top: 20px;
    }

    .qr-code-title {
      font-size: 22px;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 15px;
    }

    .qr-code-image {
      width: 220px;
      height: 220px;
      margin: 0 auto;
      background: #fff;
      padding: 15px;
      border-radius: 12px;
      display: block;
    }

    .qr-code-hint {
      font-size: 18px;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 12px;
    }
  </style>
</head>
<body>

  <div class="safe-viewport">
    <div id="frame">
      <!-- Header -->
      <div class="cta-header">
        <div class="back-button" onclick="goBack()">
          ‚Äπ Back
        </div>
        <div class="header-title" id="headerTitle">Loading...</div>
      </div>

      <!-- Loading State -->
      <div id="loadingState" class="loading">
        Loading...
      </div>

      <!-- Message Display -->
      <div id="messageDisplay" class="message"></div>

      <!-- CTA Content Container -->
      <div id="ctaContent" class="cta-content hidden">
        <!-- Dynamic content will be inserted here -->
      </div>
    </div>
  </div>

  <script>
    /* =============== Frame Scaling =============== */
    (function fit(){
      const DESIGN_W=1080, DESIGN_H=1920, frame=document.getElementById('frame');
      function apply(){
        const s=Math.min(window.innerWidth/DESIGN_W, window.innerHeight/DESIGN_H);
        frame.style.transform=`translate(-50%,-50%) scale(${s})`;
      }
      addEventListener('resize',apply);
      addEventListener('orientationchange',apply);
      addEventListener('pageshow',apply);
      addEventListener('DOMContentLoaded',apply);
      apply();
    })();

    /* =============== Core Logic =============== */
    const urlParams = new URLSearchParams(window.location.search);
    const ctaType = urlParams.get('type'); // contact, order, reserve, book, inquiry
    const itemId = urlParams.get('id'); // e.g., od001, dine004, unit001

    const loadingState = document.getElementById('loadingState');
    const ctaContent = document.getElementById('ctaContent');
    const headerTitle = document.getElementById('headerTitle');
    const messageDisplay = document.getElementById('messageDisplay');

    let itemData = null;
    let cart = {}; // For order type: { itemId: quantity }
    let cartTotal = 0;

    function goBack() {
      window.history.back();
    }

    function showMessage(text, type = 'success') {
      messageDisplay.textContent = text;
      messageDisplay.className = `message ${type} show`;
      setTimeout(() => {
        messageDisplay.classList.remove('show');
      }, 3000);
    }

    async function loadJson(path) {
      const response = await fetch(path, { cache: 'default' });
      if (!response.ok) throw new Error(`Failed to load ${path}`);
      return await response.json();
    }

    async function loadItemData() {
      try {
        loadingState.style.display = 'block';
        ctaContent.classList.add('hidden');

        // Determine which JSON file to load based on itemId prefix
        let jsonPath = '';
        let dataArray = [];

        if (itemId.startsWith('dine')) {
          jsonPath = './client/data/dining.json';
          dataArray = await loadJson(jsonPath);
        } else if (itemId.startsWith('od')) {
          jsonPath = './client/data/ondemand.json';
          const data = await loadJson(jsonPath);
          dataArray = data.ondemand || [];
        } else if (itemId.startsWith('unit')) {
          jsonPath = './client/data/unit.json';
          const data = await loadJson(jsonPath);
          dataArray = data.units || [];
        }

        // Find the item
        itemData = dataArray.find(item => item.id === itemId);

        if (!itemData) {
          throw new Error(`Item ${itemId} not found`);
        }

        console.log('Loaded item data:', itemData);

        // Render appropriate CTA type
        renderCTA();

        loadingState.style.display = 'none';
        ctaContent.classList.remove('hidden');

      } catch (error) {
        console.error('Error loading item data:', error);
        loadingState.textContent = 'Error loading data: ' + error.message;
      }
    }

    function renderCTA() {
      switch(ctaType) {
        case 'contact':
          renderContact();
          break;
        case 'order':
          renderOrder();
          break;
        case 'reserve':
          renderReserve();
          break;
        case 'book':
          renderBook();
          break;
        case 'inquiry':
          renderInquiry();
          break;
        default:
          ctaContent.innerHTML = '<p style="color: #fff;">Invalid CTA type</p>';
      }
    }

    // ========== CONTACT CTA ==========
    function renderContact() {
      headerTitle.textContent = 'Contact Information';

      // Generate QR code URL for map location
      let qrCodeHtml = '';
      if (itemData.map_url) {
        const qrCodeUrl = generateQRCode(itemData.map_url);
        qrCodeHtml = `
          <div class="qr-code-container">
            <div class="qr-code-title">üìç Scan for Directions</div>
            <img src="${qrCodeUrl}" alt="QR Code for Map" class="qr-code-image">
            <div class="qr-code-hint">Scan with your phone to open in Google Maps</div>
          </div>
        `;
      }

      const html = `
        <div class="business-header">
          ${itemData.logo ? `<img src="${itemData.logo}" alt="${itemData.name_en}" class="business-logo">` : ''}
          <div class="business-name">${itemData.name_en || itemData.name_th}</div>
          <div class="business-category">${itemData.category_en || itemData.category_th || ''}</div>
          ${itemData.description_en ? `<div class="business-description">${itemData.description_en}</div>` : ''}
        </div>

        <div class="contact-info">
          ${itemData.contact?.phone ? `
            <div class="contact-item" onclick="callPhone('${itemData.contact.phone}')">
              <div class="contact-icon">üìû</div>
              <div class="contact-details">
                <div class="contact-label">Phone</div>
                <div class="contact-value">${itemData.contact.phone}</div>
              </div>
            </div>
          ` : ''}

          ${itemData.contact?.line ? `
            <div class="contact-item" onclick="openLine('${itemData.contact.line}')">
              <div class="contact-icon">üí¨</div>
              <div class="contact-details">
                <div class="contact-label">LINE</div>
                <div class="contact-value">${itemData.contact.line}</div>
              </div>
            </div>
          ` : ''}

          ${itemData.address_en || itemData.address_th ? `
            <div class="contact-item" onclick="openMap()">
              <div class="contact-icon">üìç</div>
              <div class="contact-details">
                <div class="contact-label">Address</div>
                <div class="contact-value">${itemData.address_en || itemData.address_th}</div>
              </div>
            </div>
          ` : ''}
        </div>

        ${qrCodeHtml}

        <button class="action-button" onclick="goBack()">Back to Videos</button>
      `;

      ctaContent.innerHTML = html;
    }

    // Generate QR Code URL using free API
    function generateQRCode(data) {
      // Using QR Server API (free, no API key required)
      // Size: 300x300, error correction: M (medium)
      const encodedData = encodeURIComponent(data);
      return `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodedData}`;
    }

    function callPhone(phone) {
      window.location.href = `tel:${phone}`;
    }

    function openLine(lineId) {
      window.open(`https://line.me/R/ti/p/${lineId}`, '_blank');
    }

    function openMap() {
      if (itemData.map_url) {
        window.open(itemData.map_url, '_blank');
      }
    }

    // ========== ORDER CTA ==========
    function renderOrder() {
      headerTitle.textContent = 'Place Your Order';

      if (!itemData.menu || itemData.menu.length === 0) {
        ctaContent.innerHTML = '<p style="color: #fff; text-align: center;">No menu items available</p>';
        return;
      }

      const menuHtml = itemData.menu.map((item, index) => `
        <div class="menu-item">
          ${item.image ? `<img src="${item.image}" alt="${item.title}" class="menu-item-image">` : ''}
          <div class="menu-item-info">
            <div class="menu-item-name">${item.title || item.title_th}</div>
            <div class="menu-item-description">${item.description || item.description_th || ''}</div>
            <div class="menu-item-footer">
              <div class="menu-item-price">‡∏ø${item.price}</div>
              <div class="quantity-controls">
                <div class="qty-btn" onclick="updateQuantity(${index}, -1)">‚àí</div>
                <div class="qty-display" id="qty-${index}">0</div>
                <div class="qty-btn" onclick="updateQuantity(${index}, 1)">+</div>
              </div>
            </div>
          </div>
        </div>
      `).join('');

      const html = `
        <div class="business-header">
          ${itemData.logo ? `<img src="${itemData.logo}" alt="${itemData.name_en}" class="business-logo">` : ''}
          <div class="business-name">${itemData.name_en || itemData.name_th}</div>
          <div class="business-category">${itemData.category_en || itemData.category_th || ''}</div>
        </div>

        <div class="menu-items">
          ${menuHtml}
        </div>

        <div class="cart-summary">
          <div>
            <span class="cart-total-label">Total:</span>
            <span class="cart-total" id="cartTotal">‡∏ø0</span>
          </div>
          <button class="action-button" style="width: auto; margin-top: 0; padding: 20px 60px;" onclick="confirmOrder()" id="confirmOrderBtn" disabled>
            Confirm Order
          </button>
        </div>
      `;

      ctaContent.innerHTML = html;
    }

    function updateQuantity(menuIndex, delta) {
      const qtyDisplay = document.getElementById(`qty-${menuIndex}`);
      let currentQty = parseInt(qtyDisplay.textContent);
      currentQty = Math.max(0, currentQty + delta);
      qtyDisplay.textContent = currentQty;

      // Update cart
      if (currentQty > 0) {
        cart[menuIndex] = currentQty;
      } else {
        delete cart[menuIndex];
      }

      updateCartTotal();
    }

    function updateCartTotal() {
      let total = 0;
      for (const [index, qty] of Object.entries(cart)) {
        const menuItem = itemData.menu[parseInt(index)];
        total += menuItem.price * qty;
      }
      cartTotal = total;

      const cartTotalEl = document.getElementById('cartTotal');
      if (cartTotalEl) {
        cartTotalEl.textContent = `‡∏ø${total}`;
      }

      const confirmBtn = document.getElementById('confirmOrderBtn');
      if (confirmBtn) {
        confirmBtn.disabled = total === 0;
      }
    }

    function confirmOrder() {
      if (cartTotal === 0) return;

      // Build order summary
      let orderItems = [];
      for (const [index, qty] of Object.entries(cart)) {
        const menuItem = itemData.menu[parseInt(index)];
        orderItems.push(`${menuItem.title} x${qty} = ‡∏ø${menuItem.price * qty}`);
      }

      const orderSummary = orderItems.join('\n');

      console.log('Order confirmed:', orderSummary, '\nTotal:', cartTotal);

      // Save to Firestore (optional)
      if (window.db) {
        window.db.collection('orders').add({
          device_id: window.CONFIG.DEVICE_ID,
          project_id: window.CONFIG.PROJECT_ID,
          item_id: itemId,
          items: cart,
          total: cartTotal,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
          console.log('Order saved to Firestore');
        }).catch(err => {
          console.error('Failed to save order:', err);
        });
      }

      showMessage(`Order confirmed! Total: ‡∏ø${cartTotal}`, 'success');

      setTimeout(() => {
        goBack();
      }, 2000);
    }

    // ========== RESERVE CTA (Table Reservation) ==========
    function renderReserve() {
      headerTitle.textContent = 'Reserve a Table';

      const html = `
        <div class="business-header">
          ${itemData.logo ? `<img src="${itemData.logo}" alt="${itemData.name_en}" class="business-logo">` : ''}
          <div class="business-name">${itemData.name_en || itemData.name_th}</div>
          <div class="business-category">${itemData.category_en || itemData.category_th || ''}</div>
        </div>

        <form onsubmit="submitReservation(event)" id="reserveForm">
          <div class="form-group">
            <label class="form-label">Name *</label>
            <input type="text" class="form-input" placeholder="Your name" required>
          </div>

          <div class="form-group">
            <label class="form-label">Phone Number *</label>
            <input type="tel" class="form-input" placeholder="08x-xxx-xxxx" required>
          </div>

          <div class="form-group">
            <label class="form-label">Number of Guests *</label>
            <div class="guests-selector">
              <span class="form-label" style="margin: 0;">Guests:</span>
              <div class="guests-controls">
                <div class="guests-btn" onclick="updateGuests(-1)">‚àí</div>
                <div class="guests-display" id="guestsDisplay">2</div>
                <div class="guests-btn" onclick="updateGuests(1)">+</div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Reservation Date & Time *</label>
            <div class="datetime-group">
              <input type="date" class="form-input" id="reserveDate" required>
              <input type="time" class="form-input" id="reserveTime" required>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Special Requests</label>
            <textarea class="form-input" placeholder="Any special requirements or requests..."></textarea>
          </div>

          <button type="submit" class="action-button">Confirm Reservation</button>
        </form>
      `;

      ctaContent.innerHTML = html;

      // Set minimum date to today
      const dateInput = document.getElementById('reserveDate');
      if (dateInput) {
        const today = new Date().toISOString().split('T')[0];
        dateInput.min = today;
        dateInput.value = today;
      }

      // Set default time
      const timeInput = document.getElementById('reserveTime');
      if (timeInput) {
        timeInput.value = '19:00';
      }
    }

    let guestCount = 2;

    function updateGuests(delta) {
      guestCount = Math.max(1, Math.min(20, guestCount + delta));
      document.getElementById('guestsDisplay').textContent = guestCount;
    }

    function submitReservation(event) {
      event.preventDefault();
      const formData = new FormData(event.target);

      console.log('Reservation submitted:', {
        item_id: itemId,
        guests: guestCount,
        date: document.getElementById('reserveDate').value,
        time: document.getElementById('reserveTime').value
      });

      // Save to Firestore (optional)
      if (window.db) {
        window.db.collection('reservations').add({
          device_id: window.CONFIG.DEVICE_ID,
          project_id: window.CONFIG.PROJECT_ID,
          item_id: itemId,
          guests: guestCount,
          date: document.getElementById('reserveDate').value,
          time: document.getElementById('reserveTime').value,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
      }

      showMessage('Reservation confirmed! We will contact you shortly.', 'success');

      setTimeout(() => {
        goBack();
      }, 2000);
    }

    // ========== BOOK CTA (Service Booking - Salon, Spa, etc.) ==========
    function renderBook() {
      headerTitle.textContent = 'Book a Service';

      const html = `
        <div class="business-header">
          ${itemData.logo ? `<img src="${itemData.logo}" alt="${itemData.name_en}" class="business-logo">` : ''}
          <div class="business-name">${itemData.name_en || itemData.name_th}</div>
          <div class="business-category">${itemData.category_en || itemData.category_th || ''}</div>
          ${itemData.description_en ? `<div class="business-description">${itemData.description_en}</div>` : ''}
        </div>

        <form onsubmit="submitBooking(event)" id="bookForm">
          <div class="form-group">
            <label class="form-label">Name *</label>
            <input type="text" class="form-input" placeholder="Your name" required>
          </div>

          <div class="form-group">
            <label class="form-label">Phone Number *</label>
            <input type="tel" class="form-input" placeholder="08x-xxx-xxxx" required>
          </div>

          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" placeholder="your.email@example.com">
          </div>

          <div class="form-group">
            <label class="form-label">Preferred Date & Time *</label>
            <div class="datetime-group">
              <input type="date" class="form-input" id="bookDate" required>
              <input type="time" class="form-input" id="bookTime" required>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Service Details / Requirements *</label>
            <textarea class="form-input" placeholder="Please describe the service you need..." required></textarea>
          </div>

          <button type="submit" class="action-button">Request Booking</button>
        </form>
      `;

      ctaContent.innerHTML = html;

      // Set minimum date to today
      const dateInput = document.getElementById('bookDate');
      if (dateInput) {
        const today = new Date().toISOString().split('T')[0];
        dateInput.min = today;
        dateInput.value = today;
      }

      // Set default time
      const timeInput = document.getElementById('bookTime');
      if (timeInput) {
        timeInput.value = '10:00';
      }
    }

    function submitBooking(event) {
      event.preventDefault();

      console.log('Booking submitted:', {
        item_id: itemId,
        date: document.getElementById('bookDate').value,
        time: document.getElementById('bookTime').value
      });

      // Save to Firestore (optional)
      if (window.db) {
        window.db.collection('bookings').add({
          device_id: window.CONFIG.DEVICE_ID,
          project_id: window.CONFIG.PROJECT_ID,
          item_id: itemId,
          date: document.getElementById('bookDate').value,
          time: document.getElementById('bookTime').value,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
      }

      showMessage('Booking request sent! We will contact you to confirm.', 'success');

      setTimeout(() => {
        goBack();
      }, 2000);
    }

    // ========== INQUIRY CTA (Property Inquiries) ==========
    function renderInquiry() {
      headerTitle.textContent = 'Property Inquiry';

      const html = `
        <div class="business-header">
          <div class="business-name">${itemData.name_en || itemData.name_th || 'Property Unit'}</div>
          ${itemData.type ? `<div class="business-category">${itemData.type}</div>` : ''}
          ${itemData.price ? `<div class="business-description">Price: ‡∏ø${itemData.price?.toLocaleString()}</div>` : ''}
        </div>

        <form onsubmit="submitInquiry(event)" id="inquiryForm">
          <div class="form-group">
            <label class="form-label">Name *</label>
            <input type="text" class="form-input" placeholder="Your name" required>
          </div>

          <div class="form-group">
            <label class="form-label">Phone Number *</label>
            <input type="tel" class="form-input" placeholder="08x-xxx-xxxx" required>
          </div>

          <div class="form-group">
            <label class="form-label">Email *</label>
            <input type="email" class="form-input" placeholder="your.email@example.com" required>
          </div>

          <div class="form-group">
            <label class="form-label">Preferred Contact Method *</label>
            <select class="form-input" required>
              <option value="phone">Phone Call</option>
              <option value="email">Email</option>
              <option value="line">LINE</option>
              <option value="whatsapp">WhatsApp</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Message / Questions</label>
            <textarea class="form-input" placeholder="Tell us about your requirements, questions, or schedule a viewing..."></textarea>
          </div>

          <button type="submit" class="action-button">Submit Inquiry</button>
        </form>
      `;

      ctaContent.innerHTML = html;
    }

    function submitInquiry(event) {
      event.preventDefault();

      console.log('Inquiry submitted for:', itemId);

      // Save to Firestore (optional)
      if (window.db) {
        window.db.collection('inquiries').add({
          device_id: window.CONFIG.DEVICE_ID,
          project_id: window.CONFIG.PROJECT_ID,
          item_id: itemId,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
      }

      showMessage('Inquiry submitted! Our agent will contact you soon.', 'success');

      setTimeout(() => {
        goBack();
      }, 2000);
    }

    // ========== Initialize ==========
    if (!ctaType || !itemId) {
      loadingState.textContent = 'Error: Missing type or id parameter';
    } else {
      loadItemData();
    }
  </script>
</body>
</html>
